
<div class="marquee" id="ticker">
  <%
    leagues = Affiliation.get_all_leagues()
    
    leagues.each do |league|
      if !(Affiliation.is_in_season(league.affiliation_id))
        next
      end
      
      scores = Array.new()
      i = 1
      while scores.size == 0 && i < 31
        scores = Affiliation.get_games_by_date_range(league.affiliation_id, TIME-(i*24*60*60), TIME)
        i += 1
      end
      
      games = Array.new()
      i = 1
      while games.size == 0 && i < 31
        games = Affiliation.get_games_by_date_range(league.affiliation_id, TIME, TIME+(i*24*60*60))
        i += 1
      end
      
      
  %>
        
        <span style="color:#4696bb; border:none; font-weight:bold;"><%= league.abbreviation %></span>
  <%
      
      if scores.size != 0 then
  %>
        <span style="padding:0 3px 0 3px; color:#000000; border-right:#FFFFFF thin solid; display:inline;"><%= scores[0].start_date_time.strftime("%m/%d") %></span>
  <%
      end
      scores.each do |score|
        style = ""
        if (Team.team_is_in_profile(league.affiliation_id, score.t1_id, @user.id) || Team.team_is_in_profile(league.affiliation_id, score.t2_id, @user.id))
          style = "color: blue"
          
        end
  %>
        <span style="padding:0 3px 0 3px; color:#000000; border-right:#FFFFFF thin solid; display:inline;"><%= "#{score.t1_abbr} #{score.t1_score} vs #{score.t2_abbr} #{score.t2_score}" %></span>
  <%
      end
  %>
  
  <%
      if games.size != 0 then
      
        games.each do |game|
          style = ""
          if (Team.team_is_in_profile(league.affiliation_id, game.t1_id, @user.id) || Team.team_is_in_profile(league.affiliation_id, game.t2_id, @user.id))
            style = "color: blue"
            
          end
  %>
        <span style="padding:0 3px 0 3px; color:#000000; border-right:#FFFFFF thin solid; display:inline;"><%= "#{game.t1_abbr} vs #{game.t2_abbr} #{game.start_date_time.strftime('%d/%m %I:%M%P')}" %></span>
  <%
        end
      end
  %>
  
  <%
    end #close leagues loop
  %>
    
</div>
  
<%= javascript_tag "
        marqueeInit({
          uniqueid: 'ticker',
          style: {              
              'height': '30px',
              'border-bottom': '#CCCCCC thin solid',
              'border-left': '#CCCCCC thin solid',
              'border-right': '#CCCCCC thin solid',
              'background': 'url(/images/css/ticker-bg.jpg) no-repeat top center',
              'font-size': '.7em'              
          },
          inc: 4, //speed - pixel increment for each iteration of this marquee's movement
          mouse: 'cursor driven', //mouseover behavior ('pause' 'cursor driven' or false)
          moveatleast: 2,
          neutral: 200,
          savedirection: true
        });"
%>
